/**
 * ุณูุฑูุจุช ูุฅุตูุงุญ ุจูุงูุงุช ุงููุตุงุฏูุฉ ูู ุงููุชุตูุญ
 * ูููู ุชุดุบููู ูู Console ุงููุชุตูุญ ุฃู ุฅุถุงูุชู ูู bookmarklet
 */

(function() {
  console.log('๐ง ุจุฏุก ุฅุตูุงุญ ุจูุงูุงุช ุงููุตุงุฏูุฉ...');
  
  try {
    // ูุฑุงุกุฉ ุงูุจูุงูุงุช ุงูุญุงููุฉ
    const currentUser = localStorage.getItem('user');
    const currentToken = localStorage.getItem('token');
    
    if (!currentUser || !currentToken) {
      console.warn('โ๏ธ ูุง ุชูุฌุฏ ุจูุงูุงุช ููุฅุตูุงุญ. ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ุฃููุงู.');
      return;
    }
    
    // ุชุญููู ุจูุงูุงุช ุงููุณุชุฎุฏู
    let user;
    try {
      user = JSON.parse(currentUser);
    } catch (e) {
      console.error('โ ูุดู ุชุญููู ุจูุงูุงุช ุงููุณุชุฎุฏู:', e);
      localStorage.clear();
      console.log('๐งน ุชู ูุณุญ ุงูุจูุงูุงุช ุงูุชุงููุฉ. ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู.');
      return;
    }
    
    // ุงูุชุญูู ุฅุฐุง ูุงู token ููุฌูุฏ ุจุงููุนู
    if (user.token && user.token === currentToken) {
      console.log('โ ุงูุจูุงูุงุช ุตุญูุญุฉ ุจุงููุนู. ูุง ุญุงุฌุฉ ููุฅุตูุงุญ.');
      return;
    }
    
    // ุฅุถุงูุฉ token ุฅูู ูุงุฆู ุงููุณุชุฎุฏู
    user.token = currentToken;
    
    // ุญูุธ ุงูุจูุงูุงุช ุงููุตูุญุฉ
    localStorage.setItem('user', JSON.stringify(user));
    
    console.log('โ ุชู ุฅุตูุงุญ ุจูุงูุงุช ุงููุตุงุฏูุฉ ุจูุฌุงุญ!');
    console.log('๐ค ุงููุณุชุฎุฏู:', user.name);
    console.log('๐ญ ุงูุฏูุฑ:', user.role);
    console.log('๐ Token ููุฌูุฏ:', !!user.token);
    
    // ุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ
    if (typeof alert !== 'undefined') {
      alert('โ ุชู ุฅุตูุงุญ ุจูุงูุงุช ุงููุตุงุฏูุฉ ุจูุฌุงุญ!\n\nูุฑุฌู ุชุญุฏูุซ ุงูุตูุญุฉ ูููุชุงุจุนุฉ.');
    }
    
  } catch (error) {
    console.error('โ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุฅุตูุงุญ:', error);
    console.log('๐งน ูููุตุญ ุจูุณุญ ุงูุจูุงูุงุช ูุชุณุฌูู ุงูุฏุฎูู ูุฑุฉ ุฃุฎุฑู.');
    console.log('ููุณุญ ุงูุจูุงูุงุชุ ูู ุจุชุดุบูู: localStorage.clear()');
  }
})();
